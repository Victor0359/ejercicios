<body>
   
        <div class="container mt-5">
            <h1>CONTRATOS</h1>
         <form class= "row g-3 mt-2" action="/contratos/insertar" method="POST" onsubmit="return confirmaIngresar()">
            
            <div class="col-md-6 mb-3">
                
                <label for="id_propietarios" class="form-label">Propietario</label>
                <select class="form-select" id="id_propietarios" name="id_propietarios" required>
                <option value="">Seleccione un propietario</option>
                <% if (propietarios && propietarios.length > 0) { %>
                  <% propietarios.forEach(function(prop) { %>
                    <option value="<%= prop.id_propietarios %>">
                      <%= prop.apellido %>, <%= prop.nombre %>
                    </option>
                  <% }); %>
                <% } %>
                </select>
            </div>
             <div class="col-md-6 mb-3">
                
                <label for="id_inquilinos" class="form-label">Inquilino</label>
                <select class="form-select" id="id_inquilinos" name="id_inquilinos" required>
                <option value="">Seleccione un inquilino</option>
                <% if (inquilinos && inquilinos.length > 0) { %>
                  <% inquilinos.forEach(function(prop) { %>
                    <option value="<%= prop.id_inquilinos %>">
                      <%= prop.apellido %>, <%= prop.nombre %>
                    </option>
                  <% }); %>
                <% } %>
                </select>
            </div>
              
            <div class="col-md-6 mb-3">
                
                <label for="id_propiedades" class="form-label">Propiedad</label>
               <select class="form-select" id="id_propiedades" name="id_propiedades" required>
                        <option value="">Seleccione una propiedad</option>
                        <% if (propiedades && propiedades.length > 0) { %>
                        <% propiedades.forEach(function(prop) { 
                            if (prop.direccion && prop.direccion.trim() !== "") { %>
                            <option value="<%= prop.id_propiedades %>"><%= prop.direccion %></option>
                        <% } }); %>
                        <% } %>
                    </select>
            </div>
            <div class="col-md-6 mb-3">
                <label for="fecha_inicio" class="form-label">Fecha inicio</label>
                <input type="date" class="form-control" id="fecha_inicio" name= "fecha_inicio" placeholder="Fecha inicio">
            </div>
             <div class="col-md-6 mb-3">
                <label for="duracion_cont" class="form-label">Duracion contrato</label>
                <input type="text" class="form-control" id="duracion_cont" name="duracion_cont" placeholder="Duracion contrato">
            </div>

            <div class="col-md-6 mb-3">
                <label for="precio_inicial" class="form-label">Precio_inicial</label>
                <input type="text" class="form-control" id="precio_inicial" name="precio_inicial" placeholder="Precio_inicial">
            </div>
            <div class="col-md-6 mb-3">
                <label for="precio_actual" class="form-label">Precio actual</label>
                <input type="text" class="form-control" id="precio_actual" name="precio_actual" placeholder="Precio actual">
            </div>
            <div class="col-md-6 mb-3">
                <label for="honorarios" class="form-label">Honorarios</label>
                <input type="text" class="form-control" id="honorarios" name="honorarios" placeholder="Honorarios">
            </div>
            <div class="col-md-6 mb-3">
                <label for="fecha_final" class="form-label">Fecha Final</label>
                <input type="text" class="form-control" id="fecha_final" name="fecha_final" placeholder="Fecha Final">
            </div>

           <div class="col-md-6 mb-3">
  <button type="submit" class="btn btn-primary">Guardar</button>
  <a href="/contratos" class="btn btn-secondary">Cancelar</a>
</div>
        </form>  
       </div> 
        <!-- <div class="container mt-5">
             
           
            
            <form class="row g-3 mt-3" action="/contratos" method="POST">
                
           
            <div class="col-md-6 mb-3">
                    <input type="text" class="form-control" id="datos" name="datos" placeholder="Buscar por apellido">
            </div>
            <div class="col-md-6 mb-5">
                    <button type="submit" class="btn btn-primary">Buscar</button>
             </div>
            </form> -->
            
            <div class="container mt-5">
                <h1>Lista de Contratos</h1>
            
           <div class="row mt-3" >
               <div class= "col">
<%
function sumarMeses(fecha, meses) {
  if (!fecha || !meses) return '';
  const f = new Date(fecha);
  f.setMonth(f.getMonth() + parseInt(meses));
  if (f.getDate() !== new Date(fecha).getDate()) {
    f.setDate(0);
  }
  f.setDate(f.getDate() - 1);
  return f.toLocaleDateString('es-AR');
}
%>

                  <table class="table table-striped table-bordered border-primary">
           
                <thead>
                <thead>
                    <tr>
                        <th class="text-primary" scope="col">ID</th>
                        <th class="text-primary" scope="col">propietario</th>
                        <th class="text-primary" scope="col">inquilinos</th>
                        <th class="text-primary" scope="col">propiedades</th>
                        <th class="text-primary" scope="col">fecha</th>
                        <th class="text-primary" scope="col">duracion</th>
                        <th class="text-primary" scope="col">precio_inicial</th>
                        <th class="text-primary" scope="col">precio actual</th>
                        <th class="text-primary" scope="col">honorarios</th>
                        <th class="text-primary" scope="col">fecha </th>
                        <th class="text-primary" scope="col">Modificar</th>
                    </tr>
                </thead>
                <tbody>
        <% contratos.forEach(function(inquilino) { %>  
            <tr>
               
                <td><%= inquilino.id_contratos %></td>
                <td><%= inquilino.id_propietarios %></td>
                <td><%= inquilino.id_inquilinos %></td>
                <td><%= inquilino.id_propiedades %></td>
                <td><%= inquilino.fecha_inicio ? new Date(inquilino.fecha_inicio).toLocaleDateString('es-AR') : '' %></td>
                <td><%= inquilino.duracion_cont %></td>
                <td><%= inquilino.precio_inicial %></td>
                <td><%= inquilino.precio_actual %></td>
                <td><%= inquilino.honorarios %></td>
                <td>
                <%= sumarMeses(inquilino.fecha_inicio, inquilino.duracion_cont) %></td>
              <td>
              <a href="/contratos/modificar/<%= inquilino.id_contratos %>" class="btn btn-warning">Editar</a>

              
    
</td> 
             </tr>
        <% }); %>  
                </tbody>
            </table>
        </div> 
    </div>   
   <script>
function confirmaIngresar() {
  return confirm("¿Está seguro que desea insertar este  registro");
}
</script>
    <link rel="stylesheet" href="css/inquilinos.css">
</body>
</html>